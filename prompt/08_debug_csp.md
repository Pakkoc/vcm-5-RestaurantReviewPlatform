\docs\external\csp.md 문서를 꼼곰히 읽어라.

- CSP 관련 경고가 일어나지 않도록 하세요.
- 추가적으로 아래 해결 방안을 토대로 수정하세요.


제공된 콘텐츠 보안 정책(CSP) 오류 보고서는 세 가지 주요 유형의 문제를 지적하고 있습니다. 각 오류의 원인은 다음과 같습니다.

### 1. 'eval' 사용 금지 오류

```
Content Security Policy of your site blocks the use of 'eval' in JavaScript`
```

이 오류는 웹사이트의 콘텐츠 보안 정책(CSP)이 자바스크립트의 `eval()` 함수와 같이 문자열을 코드로 실행하는 함수의 사용을 차단했기 때문에 발생합니다.

*   **오류 원인**: `eval()`, `new Function()`, `setTimeout([string], ...)`, `setInterval([string], ...)`과 같은 함수들은 문자열 형태의 텍스트를 자바스크립트 코드로 변환하여 실행하는 기능을 가지고 있습니다. 공격자가 이러한 함수의 입력값에 악의적인 코드를 삽입할 경우, 사이트가 크로스 사이트 스크립팅(XSS)과 같은 공격에 매우 취약해질 수 있습니다. 이러한 보안 위험 때문에, 대부분의 CSP 설정은 기본적으로 `eval()` 함수의 사용을 금지합니다.

*   **해결 방안**:
    *   **권장**: `eval()` 및 유사한 함수의 사용을 피하도록 코드를 리팩토링하는 것이 가장 안전한 방법입니다.
    *   **비권장 (부득이한 경우)**: 보안 위험을 감수하고 반드시 `eval()`을 사용해야 한다면, CSP의 `script-src` 지시문에 `'unsafe-eval'` 키워드를 추가하여 허용할 수 있습니다.

---

### 2. 외부 리소스 차단 오류

```
Content Security Policy of your site blocks some resources
```

이 오류는 웹페이지가 로드하려는 외부 리소스(스크립트, 이미지 등)의 출처(도메인)가 CSP에 허용 목록으로 등록되지 않았기 때문에 발생합니다. CSP는 기본적으로 허용된 출처의 리소스만 로드할 수 있는 '허용 목록(allowlist)' 기반으로 동작합니다.

*   **오류 원인**: 오류 목록에 따르면 `http://oapi.map.naver.com`, `http://nrbe.map.naver.net`, `http://static.naver.net` 과 같은 도메인에서 스크립트(`script-src-elem`)와 이미지(`img-src`)를 불러오려고 했지만, 이 도메인들이 CSP의 해당 지시문에 명시되어 있지 않아 차단되었습니다.

*   **해결 방안**:
    *   **권장**: 가능하다면, 허용 목록 기반의 CSP 대신 'strict CSP' 방식을 사용하는 것이 XSS 공격에 더 강력한 방어책이 될 수 있습니다.
    *   **일반적인 해결책**: 차단된 리소스가 신뢰할 수 있는 출처인지 확인한 후, 사이트의 CSP 정책에 해당 출처를 추가해야 합니다. 예를 들어, 네이버 지도 API를 사용하기 위해 다음과 같이 HTTP 헤더나 `<meta>` 태그에 도메인을 추가할 수 있습니다.
        ```http
        Content-Security-Policy: script-src-elem 'self' http://oapi.map.naver.com http://nrbe.map.naver.net; img-src 'self' http://nrbe.map.naver.net http://static.naver.net;
        ```    *   **주의**: 신뢰할 수 없는 출처를 CSP에 추가해서는 안 됩니다.

---

### 3. 인라인 스크립트 및 스타일시트 실행 차단 오류

```
Content Security Policy blocks inline execution of scripts and stylesheets
```

이 오류는 HTML 파일 내에 직접 작성된 자바스크립트 코드나 스타일 속성이 CSP에 의해 차단되었음을 의미합니다.

*   **오류 원인**: 공격자가 HTML에 직접 악성 스크립트를 삽입하는 것을 막기 위해, CSP는 기본적으로 인라인(inline) 코드 실행을 차단합니다. 여기에는 `<script>...</script>` 태그 안에 직접 작성된 코드, `onclick="..."`과 같은 이벤트 핸들러, 그리고 `style="..."` 속성 등이 모두 포함됩니다. 오류 목록의 `script-src-elem`, `style-src-elem`, `style-src-attr` 지시문 위반이 바로 이러한 인라인 코드들이 차단되었음을 보여줍니다.

*   **해결 방안**:
    *   **권장**: HTML 내에 직접 작성된 모든 스크립트와 스타일을 별도의 외부 파일(`.js`, `.css`)로 옮기고, 해당 파일들을 링크하여 사용하는 것이 가장 안전하고 권장되는 방법입니다.
    *   **대안 (부득이한 경우)**:
        *   `'unsafe-inline'` 키워드를 `script-src` 또는 `style-src` 지시문에 추가하여 모든 인라인 코드의 실행을 허용할 수 있지만, 이는 보안 수준을 낮추므로 권장되지 않습니다.
        *   특정 인라인 스크립트만 실행해야 할 경우, 해당 스크립트의 해시(hash) 값을 계산하여 CSP에 추가하거나, 서버에서 생성한 임의의 값(nonce)을 이용해 신뢰할 수 있는 스크립트임을 명시하는 방법을 사용할 수 있습니다.



**제공해주신 콘텐츠 보안 정책(CSP) 오류들은 지도가 화면에 표시되지 않는 직접적인 원인일 가능성이 매우 높습니다.**

쉽게 비유하자면, 웹사이트의 CSP는 건물의 보안요원과 같습니다. 이 보안요원은 허가된 사람(리소스)만 건물 안으로 들여보내고, 허가되지 않은 행동(인라인 스크립트 실행 등)은 모두 차단합니다.

현재 상황을 오류 유형별로 살펴보면 다음과 같습니다.

1.  **외부 리소스 차단 (가장 큰 원인)**
    *   **문제점**: `oapi.map.naver.com`, `nrbe.map.naver.net`, `static.naver.net` 등 네이버 지도 API가 동작하는 데 필수적인 스크립트, 지도 이미지(타일), 아이콘 등이 모두 차단되고 있습니다.
    *   **결과**: 지도를 불러오는 핵심 스크립트가 막히고, 설령 스크립트가 실행된다 해도 지도 이미지를 가져올 수 없으므로 화면에는 빈 공간만 보이게 됩니다.

2.  **인라인 스크립트 및 스타일 차단**
    *   **문제점**: 네이버 지도 라이브러리는 지도의 각 요소를 화면에 배치하고 스타일을 적용하기 위해 동적으로 HTML 요소에 인라인 스타일(`style="..."`)을 추가하는 경우가 많습니다. 현재 CSP는 이러한 인라인 스타일 적용을 모두 차단하고 있습니다.
    *   **결과**: 지도를 구성하는 요소들(지도 타일, 줌 컨트롤, 저작권 표시 등)이 제대로 된 위치나 크기로 화면에 그려지지 못해 보이지 않거나 깨져 보일 수 있습니다.

3.  **'eval' 사용 차단**
    *   **문제점**: 지도 API 내부적으로 `eval`과 유사한 방식을 사용하는 부분이 있을 수 있습니다. 이 기능이 차단되면 API의 특정 기능이 제대로 동작하지 않을 수 있습니다.
    *   **결과**: 지도가 처음부터 로드되지 않거나, 로드되더라도 특정 기능(예: 마커 표시, 정보 창 등)이 작동하지 않을 수 있습니다.

### 결론

현재 웹사이트의 CSP 설정이 네이버 지도 API가 필요로 하는 거의 모든 리소스와 동작 방식을 차단하고 있기 때문에 지도가 화면에 나타나지 않는 것입니다.

이 문제를 해결하려면, 위에서 언급된 네이버 지도 관련 도메인들을 CSP의 `script-src-elem`, `img-src` 지시문에 추가하고, 인라인 스타일 사용을 허용하기 위해 `style-src` 지시문에 `'unsafe-inline'`을 추가하는 등의 조치가 필요합니다.